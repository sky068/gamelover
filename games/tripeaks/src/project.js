require=function e(t,r,o){function i(s,c){if(!r[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(n)return n(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r||e)},l,l.exports,e,t,r,o)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({AlertCtrl:[function(e,t,r){"use strict";cc._RF.push(t,"e60b94RABNLHLAAnFDIzXRU","AlertCtrl"),cc.Class({extends:cc.Component,properties:{labelTitle:cc.Label,labelContent:cc.Label,labelBtn:cc.Label},start:function(){},show:function(e,t,r){this.init(e,t,r),cc.Canvas.instance.node.addChild(this.node)},init:function(e,t,r){this.callback=r,this.labelTitle.string=e,this.labelContent.string=t},onOkBtn:function(){this.callback&&this.callback(),this.node.destroy()}}),cc._RF.pop()},{}],GameCtrl:[function(e,t,r){"use strict";cc._RF.push(t,"37aa86mCYpDaaV7qkgMWJnp","GameCtrl");var o=e("./PokerTripeakCtrl"),i=cc.Class({ctor:function(){this.point=1,this.suits=1},init:function(e,t){this.point=e,this.suits=t}});cc.Class({extends:cc.Component,properties:{alertPrefab:cc.Prefab,pokerPrefab:cc.Prefab,pokerLayer:cc.Node,hand:cc.Node,play:cc.Node,labelScore:cc.Label,labelChain:cc.Label,labelTime:cc.Label,btnUndo:cc.Node},onLoad:function(){this.onePairPokerArr=[],this.putPokerArr=[],this.handPokerArr=[],this.deskPokerArr=[],this.matchingPoker=null,this.scoreArr=[],this.score=0,this.curScore=0,this.startTime=0,this.chain=0,this.pokerLayer.scale=0},start:function(){this.initAllPoker();this.pokerLayer.runAction(cc.spawn(cc.scaleTo(.5,1),cc.rotateBy(.5,360)))},initAllPoker:function(){for(var e=1;e<=13;e++)for(var t=1;t<=4;t++){var r=new i;r.init(e,t),this.onePairPokerArr.push(r)}this.onePairPokerArr=this.shuffle(this.onePairPokerArr);for(var n=this.pokerLayer.getChildren(),s=0;s<n.length;s++){var c=n[s];c.getComponent("PokerCtrl").isFixed&&this.removePokerObjFromArray(c.getComponent("PokerCtrl").pokerPoint,c.getComponent("PokerCtrl").pokerSuits,this.onePairPokerArr)}for(var a=0;a<n.length;a++){var h=n[a];if(h.getComponent("PokerTripeakCtrl").pokerType=o.PokerType.DESK,h.getComponent("PokerCtrl").isFixed)h.getComponent("PokerCtrl").delegate=this;else{var l=this.onePairPokerArr.pop();h.getComponent("PokerCtrl").initPoker(l.point,l.suits,this)}this.deskPokerArr.push(h)}for(var p=0;p<this.onePairPokerArr.length;p++){var k=this.onePairPokerArr[p],u=cc.instantiate(this.pokerPrefab);u.getComponent("PokerCtrl").initPoker(k.point,k.suits,this),u.getComponent("PokerCtrl").isShowFace=!1,u.getComponent("PokerTripeakCtrl").pokerType=o.PokerType.HAND,u.getComponent("PokerCtrl").touchEnabled=!1,u.x=10*p,this.hand.addChild(u),this.handPokerArr.push(u)}this.matchingPoker=this.handPokerArr.pop(),this.putPokerArr.push(this.matchingPoker),this.matchingPoker.position=cc.v2(0,0),this.matchingPoker.parent=this.play,this.matchingPoker.getComponent("PokerCtrl").isShowFace=!0,this.handPokerArr[this.handPokerArr.length-1].getComponent("PokerCtrl").touchEnabled=!0},onPokerTouch:function(e){var t=e.getComponent("PokerCtrl"),r=e.getComponent("PokerTripeakCtrl");if(2===r.pokerType){cc.log("点击的手牌。"),t.touchEnabled=!1,t.isShowFace=!0,this.handPokerArr.pop();var o=this.handPokerArr.length;return o>0&&(this.handPokerArr[o-1].getComponent("PokerCtrl").touchEnabled=!0),this.playPoker(e),this.curScore=0,void this.addSore(this.curScore)}if(cc.log("点击的桌牌."),this.isPokerValid(e)&&t.isShowFace&&!r.hasMoved){this.playPoker(e);var i=r.parentNodesArr;if(i&&i.length>0){this.curScore=10;for(var n=0;n<i.length;n++){var s=i[n];if(this.checkOnePokerCanOpen(s))s.getComponent("PokerCtrl").turnPokerOpen()}}else cc.log("poker is a root card."),this.curScore=50;this.addSore(this.curScore)}},checkOnePokerCanOpen:function(e){var t=e.getComponent("PokerTripeakCtrl").childrenNodesArr,r=!0;if(t&&t.length>0)for(var o=0;o<t.length;o++){if(!t[o].getComponent("PokerTripeakCtrl").hasMoved){r=!1;break}}return r},checkGameOver:function(){var e=this.pokerLayer.getChildren();if(e.length<=0)return this._showAlert("Congratulations!Try again!"),!0;if(this.handPokerArr.length>0)return!1;for(var t=0;t<e.length;t++){var r=e[t].getComponent("PokerCtrl"),o=e[t].getComponent("PokerTripeakCtrl");if(this.isPokerValid(r.node)&&r.isShowFace&&!o.hasMoved)return!1}return this._showAlert("GameOver, try again!"),cc.log("game over. "),!0},_showAlert:function(e){this.startTime=0,this.scheduleOnce(function(){cc.instantiate(this.alertPrefab).getComponent("AlertCtrl").show("Alert",e,this.restartGame.bind(this))},1.5,this)},isPokerValid:function(e){var t=e.getComponent("PokerCtrl"),r=this.matchingPoker.getComponent("PokerCtrl");return 1===Math.abs(t.pokerPoint-r.pokerPoint)||12===Math.abs(t.pokerPoint-r.pokerPoint)},playPoker:function(e){e.getComponent("PokerTripeakCtrl").hasMoved=!0;var t=this.play.convertToNodeSpaceAR(e.parent.convertToWorldSpaceAR(e.position));e.oriParent=e.parent,e.oriPosition=e.position,e.parent=this.play,e.position=t;var r=cc.pDistance(t,cc.v2(0,0));e.runAction(cc.moveTo(r/1600,cc.v2(0,0))),this.putPokerArr.push(e),this.matchingPoker=e,0===this.startTime&&(this.startTime=Date.now())},addSore:function(e){this.score+=e,this.scoreArr.push(this.curScore),this.setScore(this.score),cc.log("addscore:"+e),this.chain=e>0?++this.chain:0,this.labelChain.string=this.chain,this.checkGameOver()},setScore:function(e){this.score=e,this.labelScore.string=e},shuffle:function(e){var t=void 0,r=void 0,o=void 0;for(t=e.length-1;t>0;t--)r=Math.floor(Math.random()*(t+1)),o=e[t],e[t]=e[r],e[r]=o;return e},removePokerObjFromArray:function(e,t,r){for(var o=0;o<r.length;o++){var i=r[o];if(i.point===e&&i.suits===t)return void r.splice(o,1)}},onUndo:function(){if(this.putPokerArr&&!(this.putPokerArr.length<2)){var e=this.putPokerArr.pop(),t=e.getComponent("PokerCtrl"),r=e.getComponent("PokerTripeakCtrl");r.hasMoved=!1,r.pokerType===o.PokerType.HAND&&(t.touchEnabled=!0,t.isShowFace=!1,this.handPokerArr.push(e)),this.matchingPoker=this.putPokerArr[this.putPokerArr.length-1];var i=this.play.convertToNodeSpaceAR(e.oriParent.convertToWorldSpaceAR(e.oriPosition)),n=cc.pDistance(i,e.position);if(e.runAction(cc.sequence(cc.moveTo(n/1600,i),cc.callFunc(function(){e.parent=e.oriParent,e.position=e.oriPosition}))),r.parentNodesArr&&r.parentNodesArr.length>0)for(var s=0;s<r.parentNodesArr.length;s++)r.parentNodesArr[s].getComponent("PokerCtrl").turnPokerClose();this.setScore(this.score-this.scoreArr.pop()),this.chain=0,this.labelChain.string=this.chain}},restartGame:function(){for(;this.putPokerArr&&this.putPokerArr.length>1;){var e=this.putPokerArr.pop(),t=e.getComponent("PokerCtrl"),r=e.getComponent("PokerTripeakCtrl");if(r.hasMoved=!1,r.pokerType===o.PokerType.HAND&&(t.touchEnabled=!0,t.isShowFace=!1),e.parent=e.oriParent,e.position=e.oriPosition,r.parentNodesArr&&r.parentNodesArr.length>0)for(var i=0;i<r.parentNodesArr.length;i++)r.parentNodesArr[i].getComponent("PokerCtrl").isShowFace=!1}this.hand.destroyAllChildren(),this.play.destroyAllChildren(),this.onePairPokerArr.splice(0,this.onePairPokerArr.length),this.putPokerArr.splice(0,this.putPokerArr.length),this.handPokerArr.splice(0,this.handPokerArr.length),this.deskPokerArr.splice(0,this.deskPokerArr.length),this.scoreArr.splice(0,this.scoreArr.length),this.matchingPoker=null,this.score=0,this.curScore=0,this.startTime=0,this.chain=0,this.setScore(0),this.labelChain.string=this.chain,this.labelTime.string="00:00",this.pokerLayer.scale=0,this.initAllPoker();this.pokerLayer.runAction(cc.spawn(cc.scaleTo(.5,1),cc.rotateBy(.5,360)))},update:function(e){if(0!==this.startTime){var t=parseInt((Date.now()-this.startTime)/1e3),r="00"+parseInt(t/60),o="00"+t%60,i=r.substring(r.length-2,r.length)+":"+o.substring(o.length-2,o.length);this.labelTime.string=i}}}),cc._RF.pop()},{"./PokerTripeakCtrl":"PokerTripeakCtrl"}],PokerCtrl:[function(e,t,r){"use strict";cc._RF.push(t,"e3097lL77pBKpimdiMOZ6Ie","PokerCtrl");var o=cc.Enum({SPADE:1,HEART:2,CLUB:3,DIAMOND:4});cc.Class({extends:cc.Component,properties:{rootNode:cc.Node,pokerBgNode:cc.Node,pokerFaceNode:cc.Node,pokerPointNode:cc.Node,pokerSuitsNode:cc.Node,_pokerPoint:{default:1},pokerPoint:{min:1,max:13,type:cc.Integer,set:function(e){this._pokerPoint=e,this.setPokerPoint(e)},get:function(){return this._pokerPoint}},_pokerSuits:{default:o.SPADE},pokerSuits:{type:o,set:function(e){this._cardSuits=e,this.setPokerSuits(e)},get:function(){return this._pokerSuits}},_isShowFace:{default:!0},isShowFace:{set:function(e){this._isShowFace=e,this.pokerFaceNode.opacity=e?255:0},get:function(){return this._isShowFace}},isFixed:{tooltip:"固定牌的点数和花色",default:!1},touchEnabled:!0,delegate:{default:null,visible:!1,serializable:!1}},initPoker:function(e,t,r){this.pokerPoint=e,this.pokerSuits=t,this.delegate=r},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){return cc.log("touch start"),!0},this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},onTouchEnd:function(e){cc.log("touch end."),this.touchEnabled&&this.delegate&&this.delegate.onPokerTouch&&this.delegate.onPokerTouch(this.node)},setPokerPoint:function(e){(isNaN(e)||e>13||e<1)&&cc.assert(!1,"point must be a number[1,13]!");var t=e.toString(10);1===e?t="A":11===e?t="J":12===e?t="Q":13===e&&(t="K"),this.pokerPointNode.getComponent(cc.Label).string=t},setPokerSuits:function(e){(isNaN(e)||e>4||e<1)&&cc.assert(!1,"card suits must be a number[1,4]!");var t="";switch(e){case 1:t="SPADE";break;case 2:t="HEART";break;case 3:t="CLUB";break;case 4:t="DIAMOND";break;default:t="SPADE"}this.pokerSuitsNode.getComponent(cc.Label).string=t},onLoad:function(){this.setPokerPoint(this.pokerPoint),this.setPokerSuits(this.pokerSuits),this.isShowFace=this.isShowFace},turnPokerOpen:function(e){this.turnPoker(!0,e)},turnPokerClose:function(e){this.turnPoker(!1,e)},turnPoker:function(e,t){if(this.isShowFace!==e){(!t||t<0)&&(t=.3);var r=this;this.rootNode.scaleX<0&&(this.rootNode.scaleX=1,this.pokerBgNode.scaleX=1,this.pokerFaceNode.scaleX=1);var o=cc.scaleTo(t/2,0,1),i=cc.scaleTo(t/2,-1,1),n=cc.skewTo(t/2,0,-10),s=cc.skewTo(t/2,0,0),c=cc.sequence(cc.spawn(o,n),cc.callFunc(function(){r.isShowFace=e,r.pokerFaceNode.scaleX=-1,r.pokerBgNode.scaleX=-1}),cc.spawn(i,s),cc.callFunc(function(){r.touchEnabled=!0}));this._isShowFace=e,r.touchEnabled=!1,this.rootNode.runAction(c)}}}),cc._RF.pop()},{}],PokerTripeakCtrl:[function(e,t,r){"use strict";cc._RF.push(t,"e0a5dnySnNDs7kXJiwubdTw","PokerTripeakCtrl");var o=cc.Enum({DESK:1,HAND:2});cc.Class({extends:cc.Component,properties:{pokerType:{tooltip:"牌类型，手牌还是桌上的牌",default:o.DESK,type:o,serializable:!1},oriParent:{default:null,type:cc.Node,visible:!0},oriPosition:{default:cc.v2(0,0),visible:!0},hasMoved:!1,parentNodesArr:{tooltip:"所有和当前节点有碰撞的上层节点",default:[],type:[cc.Node]},childrenNodesArr:{tooltip:"所有和当前节点有碰撞的下层节点",default:[],type:[cc.Node]}},statics:{PokerType:o},start:function(){}}),cc._RF.pop()},{}],TestCtrl:[function(e,t,r){"use strict";cc._RF.push(t,"3d6fbCZxkpNwJlQmhHje/WW","TestCtrl"),cc.Class({extends:cc.Component,properties:{card:cc.Node},start:function(){}}),cc._RF.pop()},{}]},{},["AlertCtrl","GameCtrl","PokerCtrl","PokerTripeakCtrl","TestCtrl"]);